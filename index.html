<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR SCANNER</title>
    <style>
        #result{
            max-width: 300px;
            border: 1px solid green;
            margin: 0 auto;
            word-break: break-all;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>Welcome to QR SCANNER</h1>
    <div id="reader" style="width: 300px"></div>
    <div id="time">Текущая дата и время</div>
    <div id="result"></div>

    <script src="https://unpkg.com/html5-qrcode"></script>
    <script>
        function onScanSuccess(decodedText, decodedResult) {
            let date = new Date();
            document.getElementById('result').textContent = decodedText;
            document.getElementById('time').textContent = getDate(date);
            // После успешного сканирования можно остановить сканер
            // html5QrCode.stop();
        }

        // Получаем список камер и выбираем заднюю
        Html5Qrcode.getCameras().then(cameras => {
            if (cameras && cameras.length) {
                // Находим заднюю камеру (ищем "back" или "environment" в названии)
                let backCam = cameras.find(cam => 
                    cam.label.toLowerCase().includes('back') || 
                    cam.label.toLowerCase().includes('environment')
                );
                // Если не нашли — берём первую (на всякий случай)
                let cameraId = backCam ? backCam.id : cameras[0].id;

                // Запускаем сканер на найденной камере
                const html5QrCode = new Html5Qrcode("reader");
                html5QrCode.start(
                    cameraId, 
                    { fps: 10, qrbox: 250 },
                    onScanSuccess
                );
            } else {
                document.getElementById('result').textContent = "Нет доступных камер";
            }
        }).catch(err => {
            document.getElementById('result').textContent = "Ошибка доступа к камере: " + err;
        });


    </script>
</body>
</html>
